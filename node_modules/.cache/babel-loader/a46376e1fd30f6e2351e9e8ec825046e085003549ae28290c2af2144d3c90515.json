{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Paul2\\\\Downloads\\\\front-end-main (5)\\\\front-end-main\\\\src\\\\components\\\\TrainingRoom\\\\ChatDisplay.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useLayoutEffect } from 'react';\nimport { Spinner, Alert } from 'react-bootstrap';\nimport ChatMessage from './ChatMessage';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ChatDisplay({\n  messages,\n  isLoading\n}) {\n  _s();\n  const chatEndRef = useRef(null);\n  const scrollContainerRef = useRef(null);\n  const prevMessagesLengthRef = useRef(messages.length);\n  useLayoutEffect(() => {\n    const scrollContainer = scrollContainerRef.current;\n    if (!scrollContainer) return;\n    const isScrollable = scrollContainer.scrollHeight > scrollContainer.clientHeight;\n    // *** 判斷是否是「真的」新訊息加入（避免初始加載或清空觸發） ***\n    const messagesWereAdded = messages.length > prevMessagesLengthRef.current;\n    const scrollThreshold = 100;\n    let isNearBottom = true;\n    if (isScrollable) {\n      // 檢查滾動位置是否接近底部\n      isNearBottom = scrollContainer.scrollHeight - scrollContainer.scrollTop <= scrollContainer.clientHeight + scrollThreshold;\n    } else {\n      // 如果不可滾動，總是視為在底部（以便第一條訊息出現時能滾動）\n      isNearBottom = true;\n    }\n\n    // 只有在以下情況才滾動：\n    // a) 確實有新訊息加入 (避免清空或初始加載觸發滾動)\n    // b) 且用戶原本就在底部附近 (或容器不可滾動)\n    if (messagesWereAdded && isNearBottom) {\n      const timer = setTimeout(() => {\n        var _chatEndRef$current;\n        // 確保 chatEndRef 存在\n        (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n          behavior: \"smooth\",\n          block: \"end\"\n        });\n      }, 50); // 短延遲\n      // 清理函數\n      return () => clearTimeout(timer);\n    }\n\n    // 更新前一次的訊息數量，必須在判斷邏輯之後\n    prevMessagesLengthRef.current = messages.length;\n  }, [messages]); // 依賴項保持 messages\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: scrollContainerRef,\n    className: \"chat-display-area\" // 確認沒有 mb-3\n    ,\n    style: {\n      overflowY: 'auto',\n      // 允許滾動\n      height: '100%',\n      // 佔滿父級 flex-grow 分配的高度\n      display: 'flex',\n      flexDirection: 'column'\n      // justifyContent: 'flex-start' // 預設就是 flex-start，內容會從頂部開始\n    },\n    children: [messages.length === 0 && !isLoading && /*#__PURE__*/_jsxDEV(Alert, {\n      variant: \"info\",\n      className: \"text-center small p-2 mx-auto mt-2\",\n      style: {\n        maxWidth: '80%',\n        flexShrink: 0\n      },\n      children: \"\\u8A2D\\u5B9A\\u597D\\u76EE\\u6A19\\u5F8C\\uFF0C\\u5C31\\u53EF\\u4EE5\\u958B\\u59CB\\u548C AI \\u5C0D\\u8A71\\u7DF4\\u7FD2\\u56C9\\uFF01\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 9\n    }, this), messages.map(msg => /*#__PURE__*/_jsxDEV(ChatMessage, {\n      sender: msg.sender,\n      text: msg.text\n    }, msg.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }, this)), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex justify-content-center align-items-center my-2 p-2 text-muted\",\n      style: {\n        flexShrink: 0\n      },\n      children: [/*#__PURE__*/_jsxDEV(Spinner, {\n        animation: \"border\",\n        role: \"status\",\n        size: \"sm\",\n        className: \"me-2\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"visually-hidden\",\n          children: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 11\n      }, this), \"AI \\u6B63\\u5728\\u601D\\u8003...\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: chatEndRef,\n      style: {\n        height: '1px',\n        flexShrink: 0\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatDisplay, \"fOuVhriaq3M/2LuacOb+9JJGDbo=\");\n_c = ChatDisplay;\nexport default ChatDisplay;\nvar _c;\n$RefreshReg$(_c, \"ChatDisplay\");","map":{"version":3,"names":["React","useRef","useEffect","useLayoutEffect","Spinner","Alert","ChatMessage","jsxDEV","_jsxDEV","ChatDisplay","messages","isLoading","_s","chatEndRef","scrollContainerRef","prevMessagesLengthRef","length","scrollContainer","current","isScrollable","scrollHeight","clientHeight","messagesWereAdded","scrollThreshold","isNearBottom","scrollTop","timer","setTimeout","_chatEndRef$current","scrollIntoView","behavior","block","clearTimeout","ref","className","style","overflowY","height","display","flexDirection","children","variant","maxWidth","flexShrink","fileName","_jsxFileName","lineNumber","columnNumber","map","msg","sender","text","id","animation","role","size","_c","$RefreshReg$"],"sources":["C:/Users/Paul2/Downloads/front-end-main (5)/front-end-main/src/components/TrainingRoom/ChatDisplay.js"],"sourcesContent":["import React, { useRef, useEffect, useLayoutEffect } from 'react';\nimport { Spinner, Alert } from 'react-bootstrap';\nimport ChatMessage from './ChatMessage';\n\nfunction ChatDisplay({ messages, isLoading }) {\n  const chatEndRef = useRef(null);\n  const scrollContainerRef = useRef(null);\n  const prevMessagesLengthRef = useRef(messages.length);\n\n  useLayoutEffect(() => {\n    const scrollContainer = scrollContainerRef.current;\n    if (!scrollContainer) return;\n\n    const isScrollable = scrollContainer.scrollHeight > scrollContainer.clientHeight;\n    // *** 判斷是否是「真的」新訊息加入（避免初始加載或清空觸發） ***\n    const messagesWereAdded = messages.length > prevMessagesLengthRef.current;\n    const scrollThreshold = 100;\n    let isNearBottom = true;\n\n    if (isScrollable) {\n        // 檢查滾動位置是否接近底部\n        isNearBottom = scrollContainer.scrollHeight - scrollContainer.scrollTop <= scrollContainer.clientHeight + scrollThreshold;\n    } else {\n        // 如果不可滾動，總是視為在底部（以便第一條訊息出現時能滾動）\n        isNearBottom = true;\n    }\n\n    // 只有在以下情況才滾動：\n    // a) 確實有新訊息加入 (避免清空或初始加載觸發滾動)\n    // b) 且用戶原本就在底部附近 (或容器不可滾動)\n    if (messagesWereAdded && isNearBottom) {\n        const timer = setTimeout(() => {\n            // 確保 chatEndRef 存在\n            chatEndRef.current?.scrollIntoView({ behavior: \"smooth\", block: \"end\" });\n        }, 50); // 短延遲\n        // 清理函數\n        return () => clearTimeout(timer);\n    }\n\n    // 更新前一次的訊息數量，必須在判斷邏輯之後\n    prevMessagesLengthRef.current = messages.length;\n\n  }, [messages]); // 依賴項保持 messages\n\n\n  return (\n    <div\n      ref={scrollContainerRef}\n      className=\"chat-display-area\" // 確認沒有 mb-3\n      style={{\n        overflowY: 'auto', // 允許滾動\n        height: '100%',    // 佔滿父級 flex-grow 分配的高度\n        display: 'flex',\n        flexDirection: 'column',\n        // justifyContent: 'flex-start' // 預設就是 flex-start，內容會從頂部開始\n      }}\n    >\n      {/* 1. 空狀態提示 (如果沒有訊息) */}\n      {messages.length === 0 && !isLoading && (\n        <Alert variant=\"info\" className=\"text-center small p-2 mx-auto mt-2\" style={{maxWidth: '80%', flexShrink: 0 }}>\n          設定好目標後，就可以開始和 AI 對話練習囉！\n        </Alert>\n      )}\n\n      {/* 2. 訊息列表 - 直接 map */}\n      {/* *** 移除外層帶有 marginTop: 'auto' 的 div *** */}\n      {messages.map((msg) => (\n        <ChatMessage key={msg.id} sender={msg.sender} text={msg.text} />\n      ))}\n\n      {/* 3. 加載指示器 (如果有正在加載) */}\n      {isLoading && (\n        <div className=\"d-flex justify-content-center align-items-center my-2 p-2 text-muted\" style={{ flexShrink: 0 }}>\n          <Spinner animation=\"border\" role=\"status\" size=\"sm\" className=\"me-2\">\n            <span className=\"visually-hidden\">Loading...</span>\n          </Spinner>\n          AI 正在思考...\n        </div>\n      )}\n\n      {/* 4. 滾動目標錨點 - 放在所有視覺內容的最後 */}\n      <div ref={chatEndRef} style={{ height: '1px', flexShrink: 0 }} />\n    </div>\n  );\n}\n\nexport default ChatDisplay;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}