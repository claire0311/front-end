{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Paul2\\\\Downloads\\\\front-end-main (5)\\\\front-end-main\\\\src\\\\components\\\\TrainingRoom\\\\TrainingRoom.js\",\n  _s = $RefreshSig$();\n// src/components/TrainingRoom/TrainingRoom.js (修改版)\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Form, InputGroup, Container, Row, Col, Spinner, Alert, Button } from 'react-bootstrap';\nimport ChatDisplay from './ChatDisplay';\nimport MessageInput from './MessageInput';\nimport { sendMessageToOllama, getFeedbackFromOllama } from '../../services/ollamaService';\nimport '../../styles/TrainingRoom.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CHAT_HISTORY_PREFIX = 'wingchat_history_';\nconst FEEDBACK_STORAGE_KEY = 'wingchat_feedback';\n\n// --- 接收新的 props ---\nfunction TrainingRoom({\n  characters,\n  selectedCharacter,\n  onCharacterChange\n}) {\n  _s();\n  const [goal, setGoal] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [currentMessage, setCurrentMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isGettingFeedback, setIsGettingFeedback] = useState(false);\n  const [error, setError] = useState(null);\n  const currentGoalRef = useRef(goal);\n  const getStorageKey = useCallback(() => {\n    if (!selectedCharacter || !goal.trim()) return null;\n    const goalKey = goal.trim().substring(0, 50).replace(/[^a-zA-Z0-9-_]/g, '_');\n    // *** 使用 selectedCharacter.id ***\n    return `${CHAT_HISTORY_PREFIX}${selectedCharacter.id}_${goalKey}`;\n  }, [selectedCharacter, goal]); // 依賴 selectedCharacter\n\n  useEffect(() => {\n    currentGoalRef.current = goal;\n    const storageKey = getStorageKey();\n    if (storageKey) {\n      const savedHistory = localStorage.getItem(storageKey);\n      if (savedHistory) {\n        try {\n          setMessages(JSON.parse(savedHistory));\n        } catch (e) {\n          console.error(\"Failed to parse chat history\", e);\n          setMessages([]);\n        }\n      } else {\n        setMessages([]);\n      }\n    } else if (selectedCharacter) {\n      setMessages([]);\n    } // 如果只有角色，也清空\n    setError(null);\n    // *** 依賴 selectedCharacter ***\n  }, [selectedCharacter, goal, getStorageKey]);\n  useEffect(() => {\n    const storageKey = getStorageKey();\n    if (storageKey && messages.length > 0) {\n      localStorage.setItem(storageKey, JSON.stringify(messages));\n    } else if (storageKey && messages.length === 0) {\n      localStorage.removeItem(storageKey);\n    }\n  }, [messages, getStorageKey]); // getStorageKey 依賴 selectedCharacter, goal\n\n  const handleClearChat = () => {\n    if (window.confirm(`確定要清除與 ${selectedCharacter === null || selectedCharacter === void 0 ? void 0 : selectedCharacter.name} 關於目標「${goal}」的所有聊天記錄嗎？`)) {\n      setMessages([]);\n      const storageKey = getStorageKey();\n      if (storageKey) {\n        localStorage.removeItem(storageKey);\n      }\n    }\n  };\n\n  // --- handleCharacterSelect: 處理下拉選單變更 ---\n  const handleCharacterSelect = event => {\n    const characterId = event.target.value;\n    if (characterId !== (selectedCharacter === null || selectedCharacter === void 0 ? void 0 : selectedCharacter.id)) {\n      // 清空當前聊天記錄和目標是一個好的做法，因為上下文變了\n      setMessages([]);\n      setGoal(''); // 清空目標讓用戶重新設定\n      setError(null);\n      // 調用 App.js 傳來的函數更新選中的角色\n      onCharacterChange(characterId);\n    }\n  };\n  // --- 結束新增 ---\n\n  const handleSendMessage = async () => {\n    // ... (內部邏輯不變，使用 selectedCharacter) ...\n    // *** 確認模型名稱是你想用的 ***\n    const modelToUse = \"huayi-llama3:latest\"; // 或者從 .env 讀取\n    try {\n      const historyForOllama = messages.map(msg => ({\n        role: msg.sender === 'user' ? 'user' : 'assistant',\n        content: msg.text\n      }));\n      const requestHistory = [...historyForOllama, {\n        role: 'user',\n        content: currentInput\n      }];\n      const aiResponseText = await sendMessageToOllama(goal, requestHistory, selectedCharacter, modelToUse); // 使用 modelToUse\n      // ... (處理回應)\n    } catch (err) {\n      // ... (錯誤處理)\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const parseFeedback = feedbackText => {\n    // ... (解析邏輯不變) ...\n    let summary = \"無法解析回饋摘要。\";\n    let scores = {\n      clarity: null,\n      empathy: null,\n      confidence: null,\n      appropriateness: null,\n      goalAchievement: null\n    };\n    let summaryMatch = null;\n    let summaryOnlyMatch = null;\n    let scoresTextMatch = null;\n    try {\n      summaryMatch = feedbackText.match(/\\[Feedback Summary\\]\\s*([\\s\\S]*?)\\s*\\[Scores\\]/);\n      if (summaryMatch && summaryMatch[1]) {\n        summary = summaryMatch[1].trim();\n      } else {\n        summaryOnlyMatch = feedbackText.match(/\\[Feedback Summary\\]\\s*([\\s\\S]*)/);\n        if (summaryOnlyMatch && summaryOnlyMatch[1]) {\n          summary = summaryOnlyMatch[1].trim();\n          console.warn(\"Feedback parsing: Only found summary.\");\n        } else {\n          console.warn(\"Feedback parsing: Could not find [Feedback Summary].\");\n          summary = feedbackText;\n        }\n      }\n      scoresTextMatch = feedbackText.match(/\\[Scores\\]\\s*([\\s\\S]*)/);\n      if (scoresTextMatch && scoresTextMatch[1]) {\n        const scoreLines = scoresTextMatch[1].trim().split('\\n');\n        scoreLines.forEach(line => {\n          const parts = line.split(':');\n          if (parts.length === 2) {\n            let key = parts[0].trim().toLowerCase().replace(/\\s+/g, '');\n            if (key === 'goalachievement') key = 'goalAchievement';\n            const value = parts[1].trim();\n            if (Object.prototype.hasOwnProperty.call(scores, key)) {\n              if (value.toLowerCase() === 'n/a') {\n                scores[key] = null;\n              } else {\n                const score = parseInt(value, 10);\n                if (!isNaN(score)) {\n                  scores[key] = Math.max(0, Math.min(100, score));\n                } else {\n                  console.warn(`Invalid score value: ${value}`);\n                  scores[key] = null;\n                }\n              }\n            } else {\n              console.warn(`Unexpected score key: ${key}`);\n            }\n          }\n        });\n      } else if (!summaryOnlyMatch && summaryMatch === null) {\n        console.warn(\"Feedback parsing: Could not find [Scores].\");\n      }\n    } catch (e) {\n      console.error(\"Error parsing feedback text:\", e);\n      summary = feedbackText;\n      scores = {\n        clarity: null,\n        empathy: null,\n        confidence: null,\n        appropriateness: null,\n        goalAchievement: null\n      };\n    }\n    console.log(\"Parsed Feedback:\", {\n      summary,\n      scores\n    });\n    return {\n      summary,\n      scores\n    };\n  };\n  const handleGetFeedback = async () => {\n    // ... (內部邏輯不變，使用 selectedCharacter) ...\n    // *** 確認模型名稱是你想用的 ***\n    const modelToUse = \"huayi-llama3:latest\"; // 或者從 .env 讀取\n    try {\n      var _scores$clarity, _scores$empathy, _scores$confidence, _scores$appropriatene, _scores$goalAchieveme;\n      const historyForFeedback = messages.filter(m => m.sender !== 'system').map(msg => ({\n        role: msg.sender === 'user' ? 'user' : 'assistant',\n        content: msg.text\n      }));\n      const feedbackRawText = await getFeedbackFromOllama(goal, historyForFeedback, selectedCharacter, modelToUse); // 使用 modelToUse\n      // ... (解析、儲存、顯示回饋)\n      const {\n        summary,\n        scores\n      } = parseFeedback(feedbackRawText);\n      const feedbackMessage = {\n        id: Date.now() + 1,\n        sender: 'ai',\n        text: `💡 **本次對話回饋 (${goal})**\\n\\n**摘要:**\\n${summary}\\n\\n**評分 (0-100):**\\n- 清晰度: ${(_scores$clarity = scores.clarity) !== null && _scores$clarity !== void 0 ? _scores$clarity : 'N/A'}\\n- 同理心: ${(_scores$empathy = scores.empathy) !== null && _scores$empathy !== void 0 ? _scores$empathy : 'N/A'}\\n- 自信: ${(_scores$confidence = scores.confidence) !== null && _scores$confidence !== void 0 ? _scores$confidence : 'N/A'}\\n- 適當性: ${(_scores$appropriatene = scores.appropriateness) !== null && _scores$appropriatene !== void 0 ? _scores$appropriatene : 'N/A'}\\n- 目標達成: ${(_scores$goalAchieveme = scores.goalAchievement) !== null && _scores$goalAchieveme !== void 0 ? _scores$goalAchieveme : 'N/A'}`\n      };\n      const newFeedbackEntry = {\n        timestamp: Date.now(),\n        goal: goal,\n        characterId: selectedCharacter.id,\n        characterName: selectedCharacter.name,\n        scores: scores,\n        summary: summary,\n        rawFeedback: feedbackRawText\n      };\n      const existingFeedback = JSON.parse(localStorage.getItem(FEEDBACK_STORAGE_KEY) || '[]');\n      localStorage.setItem(FEEDBACK_STORAGE_KEY, JSON.stringify([...existingFeedback, newFeedbackEntry]));\n      setMessages(prevMessages => [...prevMessages.filter(msg => msg.id !== feedbackRequestMessage.id), feedbackMessage]);\n    } catch (err) {\n      // ... (錯誤處理)\n      console.error(\"Error getting or parsing feedback from Ollama:\", err);\n      const errorMsg = err.message || \"無法獲取或處理 AI 回饋。\";\n      setError(errorMsg);\n      const errorFeedbackMessage = {\n        id: Date.now() + 1,\n        sender: 'ai',\n        text: `🤖 抱歉，獲取回饋時遇到問題：${errorMsg}`\n      };\n      setMessages(prevMessages => [...prevMessages.filter(msg => msg.id !== feedbackRequestMessage.id), errorFeedbackMessage]);\n    } finally {\n      setIsGettingFeedback(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Container, {\n    fluid: true,\n    className: \"training-room-container vh-100\",\n    children: [/*#__PURE__*/_jsxDEV(Row, {\n      className: \"goal-input-row bg-light p-2 mb-2 sticky-top shadow-sm align-items-center\",\n      children: [\" \", /*#__PURE__*/_jsxDEV(Col, {\n        md: 6,\n        className: \"mb-2 mb-md-0\",\n        children: [\" \", /*#__PURE__*/_jsxDEV(InputGroup, {\n          children: [/*#__PURE__*/_jsxDEV(InputGroup.Text, {\n            children: \"\\uD83C\\uDFAF\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n            type: \"text\",\n            placeholder: selectedCharacter ? \"輸入本次社交訓練目標...\" : \"請先選擇角色...\",\n            value: goal,\n            onChange: e => setGoal(e.target.value),\n            disabled: !selectedCharacter || isLoading || isGettingFeedback,\n            \"aria-label\": \"\\u804A\\u5929\\u76EE\\u6A19\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        md: 6,\n        className: \"d-flex justify-content-md-end align-items-center\",\n        children: [\" \", characters && characters.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex align-items-center w-100\",\n          children: [\" \", /*#__PURE__*/_jsxDEV(Form.Select, {\n            \"aria-label\": \"\\u9078\\u64C7\\u89D2\\u8272\",\n            value: (selectedCharacter === null || selectedCharacter === void 0 ? void 0 : selectedCharacter.id) || '' // 確保有值，否則給空字串\n            ,\n            onChange: handleCharacterSelect,\n            disabled: isLoading || isGettingFeedback,\n            size: \"sm\" // 讓下拉選單小一點\n            ,\n            className: \"me-2 flex-grow-1\" // 佔據空間並與按鈕間隔\n            ,\n            style: {\n              maxWidth: '250px'\n            } // 限制最大寬度\n            ,\n            children: characters.map(char => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: char.id,\n              children: char.name\n            }, char.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outline-secondary\",\n            size: \"sm\",\n            onClick: handleClearChat,\n            disabled: !selectedCharacter || messages.length === 0 || isLoading || isGettingFeedback,\n            title: selectedCharacter ? `清除與 ${selectedCharacter.name} 關於目標 \"${goal}\" 的記錄` : '清除記錄',\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-trash3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 19\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(Alert, {\n          variant: \"warning\",\n          className: \"p-1 mb-0 small w-100 text-center\",\n          children: \"\\u89D2\\u8272\\u5217\\u8868\\u8F09\\u5165\\u5931\\u6557\\u6216\\u70BA\\u7A7A\\u3002\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this), error && /*#__PURE__*/_jsxDEV(Col, {\n        xs: 12,\n        className: \"mt-2\",\n        children: /*#__PURE__*/_jsxDEV(Alert, {\n          variant: \"danger\",\n          onClose: () => setError(null),\n          dismissible: true,\n          className: \"py-1 px-2 small mb-0\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      className: \"chat-display-row\",\n      children: /*#__PURE__*/_jsxDEV(Col, {\n        children: /*#__PURE__*/_jsxDEV(ChatDisplay, {\n          messages: messages,\n          isLoading: isLoading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      className: \"message-input-row sticky-bottom bg-light p-3\",\n      children: /*#__PURE__*/_jsxDEV(Col, {\n        children: /*#__PURE__*/_jsxDEV(MessageInput, {\n          currentMessage: currentMessage,\n          onMessageChange: setCurrentMessage,\n          onSendMessage: handleSendMessage,\n          onGetFeedback: handleGetFeedback,\n          isLoading: isLoading,\n          isGettingFeedback: isGettingFeedback,\n          disabled: !selectedCharacter || !goal.trim()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 5\n  }, this);\n}\n_s(TrainingRoom, \"oqi9V6Tq0pk0T9QnlQqqTYQDW9E=\");\n_c = TrainingRoom;\nexport default TrainingRoom;\nvar _c;\n$RefreshReg$(_c, \"TrainingRoom\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","Form","InputGroup","Container","Row","Col","Spinner","Alert","Button","ChatDisplay","MessageInput","sendMessageToOllama","getFeedbackFromOllama","jsxDEV","_jsxDEV","CHAT_HISTORY_PREFIX","FEEDBACK_STORAGE_KEY","TrainingRoom","characters","selectedCharacter","onCharacterChange","_s","goal","setGoal","messages","setMessages","currentMessage","setCurrentMessage","isLoading","setIsLoading","isGettingFeedback","setIsGettingFeedback","error","setError","currentGoalRef","getStorageKey","trim","goalKey","substring","replace","id","current","storageKey","savedHistory","localStorage","getItem","JSON","parse","e","console","length","setItem","stringify","removeItem","handleClearChat","window","confirm","name","handleCharacterSelect","event","characterId","target","value","handleSendMessage","modelToUse","historyForOllama","map","msg","role","sender","content","text","requestHistory","currentInput","aiResponseText","err","parseFeedback","feedbackText","summary","scores","clarity","empathy","confidence","appropriateness","goalAchievement","summaryMatch","summaryOnlyMatch","scoresTextMatch","match","warn","scoreLines","split","forEach","line","parts","key","toLowerCase","Object","prototype","hasOwnProperty","call","score","parseInt","isNaN","Math","max","min","log","handleGetFeedback","_scores$clarity","_scores$empathy","_scores$confidence","_scores$appropriatene","_scores$goalAchieveme","historyForFeedback","filter","m","feedbackRawText","feedbackMessage","Date","now","newFeedbackEntry","timestamp","characterName","rawFeedback","existingFeedback","prevMessages","feedbackRequestMessage","errorMsg","message","errorFeedbackMessage","fluid","className","children","md","Text","fileName","_jsxFileName","lineNumber","columnNumber","Control","type","placeholder","onChange","disabled","Select","size","style","maxWidth","char","variant","onClick","title","xs","onClose","dismissible","onMessageChange","onSendMessage","onGetFeedback","_c","$RefreshReg$"],"sources":["C:/Users/Paul2/Downloads/front-end-main (5)/front-end-main/src/components/TrainingRoom/TrainingRoom.js"],"sourcesContent":["// src/components/TrainingRoom/TrainingRoom.js (修改版)\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Form, InputGroup, Container, Row, Col, Spinner, Alert, Button } from 'react-bootstrap';\nimport ChatDisplay from './ChatDisplay';\nimport MessageInput from './MessageInput';\nimport { sendMessageToOllama, getFeedbackFromOllama } from '../../services/ollamaService';\nimport '../../styles/TrainingRoom.css';\n\nconst CHAT_HISTORY_PREFIX = 'wingchat_history_';\nconst FEEDBACK_STORAGE_KEY = 'wingchat_feedback';\n\n// --- 接收新的 props ---\nfunction TrainingRoom({ characters, selectedCharacter, onCharacterChange }) {\n  const [goal, setGoal] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [currentMessage, setCurrentMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isGettingFeedback, setIsGettingFeedback] = useState(false);\n  const [error, setError] = useState(null);\n  const currentGoalRef = useRef(goal);\n\n  const getStorageKey = useCallback(() => {\n      if (!selectedCharacter || !goal.trim()) return null;\n      const goalKey = goal.trim().substring(0, 50).replace(/[^a-zA-Z0-9-_]/g, '_');\n      // *** 使用 selectedCharacter.id ***\n      return `${CHAT_HISTORY_PREFIX}${selectedCharacter.id}_${goalKey}`;\n  }, [selectedCharacter, goal]); // 依賴 selectedCharacter\n\n  useEffect(() => {\n    currentGoalRef.current = goal;\n    const storageKey = getStorageKey();\n    if (storageKey) {\n      const savedHistory = localStorage.getItem(storageKey);\n      if (savedHistory) {\n        try { setMessages(JSON.parse(savedHistory)); }\n        catch (e) { console.error(\"Failed to parse chat history\", e); setMessages([]); }\n      } else { setMessages([]); }\n    } else if (selectedCharacter) { setMessages([]); } // 如果只有角色，也清空\n     setError(null);\n  // *** 依賴 selectedCharacter ***\n  }, [selectedCharacter, goal, getStorageKey]);\n\n   useEffect(() => {\n     const storageKey = getStorageKey();\n     if (storageKey && messages.length > 0) { localStorage.setItem(storageKey, JSON.stringify(messages)); }\n     else if (storageKey && messages.length === 0) { localStorage.removeItem(storageKey); }\n   }, [messages, getStorageKey]); // getStorageKey 依賴 selectedCharacter, goal\n\n  const handleClearChat = () => {\n      if (window.confirm(`確定要清除與 ${selectedCharacter?.name} 關於目標「${goal}」的所有聊天記錄嗎？`)) {\n          setMessages([]);\n          const storageKey = getStorageKey();\n          if (storageKey) { localStorage.removeItem(storageKey); }\n      }\n  }\n\n  // --- handleCharacterSelect: 處理下拉選單變更 ---\n  const handleCharacterSelect = (event) => {\n      const characterId = event.target.value;\n      if (characterId !== selectedCharacter?.id) {\n          // 清空當前聊天記錄和目標是一個好的做法，因為上下文變了\n          setMessages([]);\n          setGoal(''); // 清空目標讓用戶重新設定\n          setError(null);\n          // 調用 App.js 傳來的函數更新選中的角色\n          onCharacterChange(characterId);\n      }\n  };\n  // --- 結束新增 ---\n\n\n  const handleSendMessage = async () => {\n    // ... (內部邏輯不變，使用 selectedCharacter) ...\n    // *** 確認模型名稱是你想用的 ***\n    const modelToUse = \"huayi-llama3:latest\"; // 或者從 .env 讀取\n    try {\n        const historyForOllama = messages.map(msg => ({ role: msg.sender === 'user' ? 'user' : 'assistant', content: msg.text }));\n        const requestHistory = [...historyForOllama, { role: 'user', content: currentInput }];\n        const aiResponseText = await sendMessageToOllama(goal, requestHistory, selectedCharacter, modelToUse); // 使用 modelToUse\n        // ... (處理回應)\n    } catch (err) {\n        // ... (錯誤處理)\n    } finally { setIsLoading(false); }\n  };\n\n  const parseFeedback = (feedbackText) => {\n    // ... (解析邏輯不變) ...\n    let summary = \"無法解析回饋摘要。\";\n    let scores = { clarity: null, empathy: null, confidence: null, appropriateness: null, goalAchievement: null };\n    let summaryMatch = null; let summaryOnlyMatch = null; let scoresTextMatch = null;\n    try {\n        summaryMatch = feedbackText.match(/\\[Feedback Summary\\]\\s*([\\s\\S]*?)\\s*\\[Scores\\]/);\n        if (summaryMatch && summaryMatch[1]) { summary = summaryMatch[1].trim(); }\n        else {\n            summaryOnlyMatch = feedbackText.match(/\\[Feedback Summary\\]\\s*([\\s\\S]*)/);\n            if (summaryOnlyMatch && summaryOnlyMatch[1]) { summary = summaryOnlyMatch[1].trim(); console.warn(\"Feedback parsing: Only found summary.\"); }\n            else { console.warn(\"Feedback parsing: Could not find [Feedback Summary].\"); summary = feedbackText; }\n        }\n        scoresTextMatch = feedbackText.match(/\\[Scores\\]\\s*([\\s\\S]*)/);\n        if (scoresTextMatch && scoresTextMatch[1]) {\n            const scoreLines = scoresTextMatch[1].trim().split('\\n');\n            scoreLines.forEach(line => {\n                const parts = line.split(':');\n                if (parts.length === 2) {\n                    let key = parts[0].trim().toLowerCase().replace(/\\s+/g, '');\n                    if (key === 'goalachievement') key = 'goalAchievement';\n                    const value = parts[1].trim();\n                    if (Object.prototype.hasOwnProperty.call(scores, key)) {\n                         if (value.toLowerCase() === 'n/a') { scores[key] = null; }\n                         else { const score = parseInt(value, 10); if (!isNaN(score)) { scores[key] = Math.max(0, Math.min(100, score)); } else { console.warn(`Invalid score value: ${value}`); scores[key] = null; } }\n                    } else { console.warn(`Unexpected score key: ${key}`); }\n                }\n            });\n        } else if (!summaryOnlyMatch && summaryMatch === null){ console.warn(\"Feedback parsing: Could not find [Scores].\"); }\n    } catch (e) { console.error(\"Error parsing feedback text:\", e); summary = feedbackText; scores = { clarity: null, empathy: null, confidence: null, appropriateness: null, goalAchievement: null }; }\n    console.log(\"Parsed Feedback:\", { summary, scores });\n    return { summary, scores };\n  }\n\n  const handleGetFeedback = async () => {\n    // ... (內部邏輯不變，使用 selectedCharacter) ...\n    // *** 確認模型名稱是你想用的 ***\n     const modelToUse = \"huayi-llama3:latest\"; // 或者從 .env 讀取\n     try {\n         const historyForFeedback = messages.filter(m => m.sender !== 'system').map(msg => ({ role: msg.sender === 'user' ? 'user' : 'assistant', content: msg.text }));\n         const feedbackRawText = await getFeedbackFromOllama(goal, historyForFeedback, selectedCharacter, modelToUse); // 使用 modelToUse\n         // ... (解析、儲存、顯示回饋)\n          const { summary, scores } = parseFeedback(feedbackRawText);\n          const feedbackMessage = { id: Date.now() + 1, sender: 'ai', text: `💡 **本次對話回饋 (${goal})**\\n\\n**摘要:**\\n${summary}\\n\\n**評分 (0-100):**\\n- 清晰度: ${scores.clarity ?? 'N/A'}\\n- 同理心: ${scores.empathy ?? 'N/A'}\\n- 自信: ${scores.confidence ?? 'N/A'}\\n- 適當性: ${scores.appropriateness ?? 'N/A'}\\n- 目標達成: ${scores.goalAchievement ?? 'N/A'}` };\n          const newFeedbackEntry = { timestamp: Date.now(), goal: goal, characterId: selectedCharacter.id, characterName: selectedCharacter.name, scores: scores, summary: summary, rawFeedback: feedbackRawText };\n          const existingFeedback = JSON.parse(localStorage.getItem(FEEDBACK_STORAGE_KEY) || '[]');\n          localStorage.setItem(FEEDBACK_STORAGE_KEY, JSON.stringify([...existingFeedback, newFeedbackEntry]));\n          setMessages(prevMessages => [...prevMessages.filter(msg => msg.id !== feedbackRequestMessage.id), feedbackMessage]);\n     } catch (err) {\n         // ... (錯誤處理)\n         console.error(\"Error getting or parsing feedback from Ollama:\", err);\n         const errorMsg = err.message || \"無法獲取或處理 AI 回饋。\";\n         setError(errorMsg);\n         const errorFeedbackMessage = { id: Date.now() + 1, sender: 'ai', text: `🤖 抱歉，獲取回饋時遇到問題：${errorMsg}` };\n          setMessages(prevMessages => [...prevMessages.filter(msg => msg.id !== feedbackRequestMessage.id), errorFeedbackMessage]);\n     } finally { setIsGettingFeedback(false); }\n  };\n\n  return (\n    <Container fluid className=\"training-room-container vh-100\">\n      {/* --- 目標輸入與角色資訊 (修改佈局) --- */}\n      <Row className=\"goal-input-row bg-light p-2 mb-2 sticky-top shadow-sm align-items-center\"> {/* 使用 align-items-center 垂直居中 */}\n        {/* 目標輸入框 */}\n        <Col md={6} className=\"mb-2 mb-md-0\"> {/* 調整欄寬 */}\n          <InputGroup>\n            <InputGroup.Text>🎯</InputGroup.Text>\n            <Form.Control\n              type=\"text\"\n              placeholder={selectedCharacter ? \"輸入本次社交訓練目標...\" : \"請先選擇角色...\"}\n              value={goal}\n              onChange={(e) => setGoal(e.target.value)}\n              disabled={!selectedCharacter || isLoading || isGettingFeedback}\n              aria-label=\"聊天目標\"\n            />\n          </InputGroup>\n        </Col>\n\n        {/* 角色選擇和清除按鈕 */}\n        <Col md={6} className=\"d-flex justify-content-md-end align-items-center\"> {/* 調整欄寬並靠右 */}\n          {characters && characters.length > 0 ? (\n            <div className=\"d-flex align-items-center w-100\"> {/* 讓內部元素佈局 */}\n              <Form.Select\n                aria-label=\"選擇角色\"\n                value={selectedCharacter?.id || ''} // 確保有值，否則給空字串\n                onChange={handleCharacterSelect}\n                disabled={isLoading || isGettingFeedback}\n                size=\"sm\" // 讓下拉選單小一點\n                className=\"me-2 flex-grow-1\" // 佔據空間並與按鈕間隔\n                style={{ maxWidth: '250px' }} // 限制最大寬度\n              >\n                {/* 可以加一個預設提示選項 */}\n                {/* <option value=\"\" disabled={selectedCharacter !== null}>-- 選擇對話角色 --</option> */}\n                {characters.map(char => (\n                  <option key={char.id} value={char.id}>\n                    {char.name}\n                  </option>\n                ))}\n              </Form.Select>\n              <Button\n                  variant=\"outline-secondary\"\n                  size=\"sm\"\n                  onClick={handleClearChat}\n                  disabled={!selectedCharacter || messages.length === 0 || isLoading || isGettingFeedback}\n                  title={selectedCharacter ? `清除與 ${selectedCharacter.name} 關於目標 \"${goal}\" 的記錄` : '清除記錄'}\n              >\n                  <i className=\"bi bi-trash3\"></i> {/* 只留圖標 */}\n              </Button>\n            </div>\n          ) : (\n            <Alert variant=\"warning\" className=\"p-1 mb-0 small w-100 text-center\">\n              角色列表載入失敗或為空。\n            </Alert>\n          )}\n        </Col>\n\n        {/* 錯誤提示 */}\n        {error && (\n            <Col xs={12} className=\"mt-2\">\n                <Alert variant=\"danger\" onClose={() => setError(null)} dismissible className=\"py-1 px-2 small mb-0\">\n                    {error}\n                </Alert>\n            </Col>\n        )}\n      </Row>\n\n      {/* --- 聊天顯示區域 (保持不變) --- */}\n      <Row className=\"chat-display-row\">\n        <Col>\n          <ChatDisplay messages={messages} isLoading={isLoading} />\n        </Col>\n      </Row>\n\n      {/* --- 訊息輸入區域 (保持不變) --- */}\n      <Row className=\"message-input-row sticky-bottom bg-light p-3\">\n        <Col>\n          <MessageInput\n            currentMessage={currentMessage}\n            onMessageChange={setCurrentMessage}\n            onSendMessage={handleSendMessage}\n            onGetFeedback={handleGetFeedback}\n            isLoading={isLoading}\n            isGettingFeedback={isGettingFeedback}\n            disabled={!selectedCharacter || !goal.trim()}\n          />\n        </Col>\n      </Row>\n    </Container>\n  );\n}\n\nexport default TrainingRoom;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}